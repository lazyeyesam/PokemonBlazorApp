@rendermode InteractiveServer
@inject DatabaseContext Context

<div class="card">
    <div class="card-body bg-light">
        <h4 class="card-title">Edit Pokemon</h4>
        <EditForm Model="model" OnValidSubmit="Submit" FormName="editPokemonForm">
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="name" class="form-label">Name</label>
                    <InputText class="form-control" id="name" name="name" @bind-Value="model.Name" placeholder="Name" required />
                </div>
                <div class="col-md-3">
                    <label for="type" class="form-label">Type</label>
                    <InputText class="form-control" id="type" name="type" placeholder="Type" @bind-Value="model.Type" required />
                </div>
                <div class="col-md-3">
                    <label for="total" class="form-label">Total</label>
                    <InputNumber class="form-control" id="total" name="total" placeholder="Total" @bind-Value="model.Total" min="1" required />
                </div>
                <div class="col-md-3">
                    <label for="hp" class="form-label">HP</label>
                    <InputNumber class="form-control" id="hp" name="hp" placeholder="HP" @bind-Value="model.HP" min="1" required />
                </div>
                <div class="col-md-3">
                    <label for="attack" class="form-label">Attack</label>
                    <InputNumber class="form-control" id="attack" name="attack" placeholder="Attack" @bind-Value="model.Attack" min="1" required />
                </div>
                <div class="col-md-3">
                    <label for="defence" class="form-label">Defence</label>
                    <InputNumber class="form-control" id="defence" name="defence" placeholder="Defence" @bind-Value="model.Defence" min="1" required />
                </div>
                <div class="col-md-3">
                    <label for="speed" class="form-label">Speed</label>
                    <InputNumber class="form-control" id="speed" name="speed" placeholder="Speed" @bind-Value="model.Speed" min="1" required />
                </div>
                <div class="col-md-3">
                    <label for="generation" class="form-label">Generation</label>
                    <InputNumber class="form-control" id="generation" name="generation" placeholder="Generation" @bind-Value="model.Generation" min="1" required />
                </div>
                <div class="col-md-3">
                    <InputCheckbox class="form-check-input" id="legendary" name="legendary" @bind-Value="model.Legendary" />
                    <label for="legendary" class="form-label">Is Legendary?</label>
                </div>
            </div>
            <div class="d-grid col-3 float-end">
                <button type="submit" class="btn btn-primary">Edit</button>
            </div>
        </EditForm>
    </div>
</div>

@code {
    [Parameter]
    public EventCallback<bool> OnPokemonChanged { get; set; }

    private Pokemon model;

    protected override void OnInitialized()
    {
        model = new();
    }

    public void Edit(Pokemon editPokemon)
    {
        model = Context.Pokemons.Single(pokemon => pokemon.Id == editPokemon.Id);
    }

    public async void Submit()
    {
        Context.Pokemons.Update(model);
        await Context.SaveChangesAsync();

        model = new();
        await OnPokemonChanged.InvokeAsync();
    }

}